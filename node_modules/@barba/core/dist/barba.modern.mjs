function t(){return t=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},t.apply(this,arguments)}var e;class i{constructor(){this.before=void 0,this.beforeLeave=void 0,this.leave=void 0,this.afterLeave=void 0,this.beforeEnter=void 0,this.enter=void 0,this.afterEnter=void 0,this.after=void 0}}!function(t){t[t.off=0]="off",t[t.error=1]="error",t[t.warning=2]="warning",t[t.info=3]="info",t[t.debug=4]="debug"}(e||(e={}));let s=e.off;class r{static getLevel(){return s}static setLevel(t){return s=e[t],s}constructor(t){this.t=void 0,this.t=t}error(...t){this.i(console.error,e.error,t)}warn(...t){this.i(console.warn,e.warning,t)}info(...t){this.i(console.info,e.info,t)}debug(...t){this.i(console.log,e.debug,t)}i(t,e,i){e<=r.getLevel()&&t.apply(console,[`[${this.t}] `].concat(i))}}function n(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function h(t){return t&&t.sensitive?"":"i"}const o={container:"container",history:"history",namespace:"namespace",prefix:"data-barba",prevent:"prevent",wrapper:"wrapper"},a=new class{constructor(){this.h=o,this.o=void 0,this.u={after:null,before:null,parent:null}}toString(t){return t.outerHTML}toDocument(t){return this.o||(this.o=new DOMParser),this.o.parseFromString(t,"text/html")}toElement(t){const e=document.createElement("div");return e.innerHTML=t,e}getHtml(t=document){return this.toString(t.documentElement)}getWrapper(t=document){return t.querySelector(`[${this.h.prefix}="${this.h.wrapper}"]`)}getContainer(t=document){return t.querySelector(`[${this.h.prefix}="${this.h.container}"]`)}removeContainer(t){document.body.contains(t)&&(this.l(t),t.parentNode.removeChild(t))}addContainer(t,e){const i=this.getContainer()||this.u.before;i?this.p(t,i):this.u.after?this.u.after.parentNode.insertBefore(t,this.u.after):this.u.parent?this.u.parent.appendChild(t):e.appendChild(t)}getSibling(){return this.u}getNamespace(t=document){const e=t.querySelector(`[${this.h.prefix}-${this.h.namespace}]`);return e?e.getAttribute(`${this.h.prefix}-${this.h.namespace}`):null}getHref(t){if(t.tagName&&"a"===t.tagName.toLowerCase()){if("string"==typeof t.href)return t.href;const e=t.getAttribute("href")||t.getAttribute("xlink:href");if(e)return this.resolveUrl(e.baseVal||e)}return null}resolveUrl(...t){const e=t.length;if(0===e)throw new Error("resolveUrl requires at least one argument; got none.");const i=document.createElement("base");if(i.href=arguments[0],1===e)return i.href;const s=document.getElementsByTagName("head")[0];s.insertBefore(i,s.firstChild);const r=document.createElement("a");let n;for(let t=1;t<e;t++)r.href=arguments[t],n=r.href,i.href=n;return s.removeChild(i),n}p(t,e){e.parentNode.insertBefore(t,e.nextSibling)}l(t){return this.u={after:t.nextElementSibling,before:t.previousElementSibling,parent:t.parentElement},this.u}},c=new class{constructor(){this.v=void 0,this.m=[],this.g=-1}init(t,e){this.v="barba";const i={data:{},ns:e,scroll:{x:window.scrollX,y:window.scrollY},url:t};this.g=0,this.m.push(i);const s={from:this.v,index:this.g,states:[...this.m]};window.history&&window.history.replaceState(s,"",t)}change(t,e,i){if(i&&i.state){const{state:t}=i,{index:s}=t;e=this.P(this.g-s),this.replace(t.states),this.g=s}else this.add(t,e);return e}add(t,e,i,s){const r=null!=i?i:this.k(e),n={data:null!=s?s:{},ns:"tmp",scroll:{x:window.scrollX,y:window.scrollY},url:t};switch(r){case"push":this.g=this.size,this.m.push(n);break;case"replace":this.set(this.g,n)}const h={from:this.v,index:this.g,states:[...this.m]};switch(r){case"push":window.history&&window.history.pushState(h,"",t);break;case"replace":window.history&&window.history.replaceState(h,"",t)}}store(e,i){const s=i||this.g,r=this.get(s);r.data=t({},r.data,e),this.set(s,r);const n={from:this.v,index:this.g,states:[...this.m]};window.history.replaceState(n,"")}update(e,i){const s=i||this.g,r=t({},this.get(s),e);this.set(s,r)}remove(t){t?this.m.splice(t,1):this.m.pop(),this.g--}clear(){this.m=[],this.g=-1}replace(t){this.m=t}get(t){return this.m[t]}set(t,e){return this.m[t]=e}get current(){return this.m[this.g]}get previous(){return this.g<1?null:this.m[this.g-1]}get size(){return this.m.length}k(t){let e="push";const i=t,s=`${o.prefix}-${o.history}`;return i.hasAttribute&&i.hasAttribute(s)&&(e=i.getAttribute(s)),e}P(t){return Math.abs(t)>1?t>0?"forward":"back":0===t?"popstate":t>0?"back":"forward"}},u=async(t,e)=>{if(!e.next.html){const i=await t,{next:s}=e;if(i){const t=a.toElement(i.html);s.namespace=a.getNamespace(t),s.container=a.getContainer(t),s.url=i.url,s.html=i.html,c.update({ns:s.namespace});const{title:e}=a.toDocument(i.html);document.title=e}}},l=function t(e,i,s){return e instanceof RegExp?function(t,e){if(!e)return t;for(var i=/\((?:\?<(.*?)>)?(?!\?)/g,s=0,r=i.exec(t.source);r;)e.push({name:r[1]||s++,prefix:"",suffix:"",modifier:"",pattern:""}),r=i.exec(t.source);return t}(e,i):Array.isArray(e)?function(e,i,s){var r=e.map(function(e){return t(e,i,s).source});return new RegExp("(?:".concat(r.join("|"),")"),h(s))}(e,i,s):function(t,e,i){return function(t,e,i){void 0===i&&(i={});for(var s=i.strict,r=void 0!==s&&s,o=i.start,a=void 0===o||o,c=i.end,u=void 0===c||c,l=i.encode,f=void 0===l?function(t){return t}:l,d=i.delimiter,w=void 0===d?"/#?":d,p=i.endsWith,v="[".concat(n(void 0===p?"":p),"]|$"),m="[".concat(n(w),"]"),g=a?"^":"",b=0,y=t;b<y.length;b++){var E=y[b];if("string"==typeof E)g+=n(f(E));else{var x=n(f(E.prefix)),P=n(f(E.suffix));if(E.pattern)if(e&&e.push(E),x||P)if("+"===E.modifier||"*"===E.modifier){var k="*"===E.modifier?"?":"";g+="(?:".concat(x,"((?:").concat(E.pattern,")(?:").concat(P).concat(x,"(?:").concat(E.pattern,"))*)").concat(P,")").concat(k)}else g+="(?:".concat(x,"(").concat(E.pattern,")").concat(P,")").concat(E.modifier);else g+="+"===E.modifier||"*"===E.modifier?"((?:".concat(E.pattern,")").concat(E.modifier,")"):"(".concat(E.pattern,")").concat(E.modifier);else g+="(?:".concat(x).concat(P,")").concat(E.modifier)}}if(u)r||(g+="".concat(m,"?")),g+=i.endsWith?"(?=".concat(v,")"):"$";else{var A=t[t.length-1],_="string"==typeof A?m.indexOf(A[A.length-1])>-1:void 0===A;r||(g+="(?:".concat(m,"(?=").concat(v,"))?")),_||(g+="(?=".concat(m,"|").concat(v,")"))}return new RegExp(g,h(i))}(function(t,e){void 0===e&&(e={});for(var i=function(t){for(var e=[],i=0;i<t.length;){var s=t[i];if("*"!==s&&"+"!==s&&"?"!==s)if("\\"!==s)if("{"!==s)if("}"!==s)if(":"!==s)if("("!==s)e.push({type:"CHAR",index:i,value:t[i++]});else{var r=1,n="";if("?"===t[o=i+1])throw new TypeError('Pattern cannot start with "?" at '.concat(o));for(;o<t.length;)if("\\"!==t[o]){if(")"===t[o]){if(0==--r){o++;break}}else if("("===t[o]&&(r++,"?"!==t[o+1]))throw new TypeError("Capturing groups are not allowed at ".concat(o));n+=t[o++]}else n+=t[o++]+t[o++];if(r)throw new TypeError("Unbalanced pattern at ".concat(i));if(!n)throw new TypeError("Missing pattern at ".concat(i));e.push({type:"PATTERN",index:i,value:n}),i=o}else{for(var h="",o=i+1;o<t.length;){var a=t.charCodeAt(o);if(!(a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122||95===a))break;h+=t[o++]}if(!h)throw new TypeError("Missing parameter name at ".concat(i));e.push({type:"NAME",index:i,value:h}),i=o}else e.push({type:"CLOSE",index:i,value:t[i++]});else e.push({type:"OPEN",index:i,value:t[i++]});else e.push({type:"ESCAPED_CHAR",index:i++,value:t[i++]});else e.push({type:"MODIFIER",index:i,value:t[i++]})}return e.push({type:"END",index:i,value:""}),e}(t),s=e.prefixes,r=void 0===s?"./":s,h="[^".concat(n(e.delimiter||"/#?"),"]+?"),o=[],a=0,c=0,u="",l=function(t){if(c<i.length&&i[c].type===t)return i[c++].value},f=function(t){var e=l(t);if(void 0!==e)return e;var s=i[c],r=s.index;throw new TypeError("Unexpected ".concat(s.type," at ").concat(r,", expected ").concat(t))},d=function(){for(var t,e="";t=l("CHAR")||l("ESCAPED_CHAR");)e+=t;return e};c<i.length;){var w=l("CHAR"),p=l("NAME"),v=l("PATTERN");if(p||v)-1===r.indexOf(g=w||"")&&(u+=g,g=""),u&&(o.push(u),u=""),o.push({name:p||a++,prefix:g,suffix:"",pattern:v||h,modifier:l("MODIFIER")||""});else{var m=w||l("ESCAPED_CHAR");if(m)u+=m;else if(u&&(o.push(u),u=""),l("OPEN")){var g=d(),b=l("NAME")||"",y=l("PATTERN")||"",E=d();f("CLOSE"),o.push({name:b||(y?a++:""),pattern:b&&!y?h:y,prefix:g,suffix:E,modifier:l("MODIFIER")||""})}else f("END")}}return o}(t,i),e,i)}(e,i,s)};var f={__proto__:null,update:u,nextTick:()=>new Promise(t=>{window.requestAnimationFrame(t)}),pathToRegexp:l};const d=()=>window.location.origin,w=(t=window.location.href)=>p(t).port,p=t=>{let e;const i=t.match(/:\d+/);if(null===i)/^http/.test(t)&&(e=80),/^https/.test(t)&&(e=443);else{const t=i[0].substring(1);e=parseInt(t,10)}let s,r=t.replace(d(),""),n={};const h=r.indexOf("#");h>=0&&(s=r.slice(h+1),r=r.slice(0,h));const o=r.indexOf("?");return o>=0&&(n=v(r.slice(o+1)),r=r.slice(0,o)),{hash:s,path:r,port:e,query:n}},v=t=>t.split("&").reduce((t,e)=>{const[i,s]=e.split("=");return t[i]=s,t},{}),m=(t=window.location.href)=>t.replace(/(\/#.*|\/|#.*)$/,"");var g={__proto__:null,getHref:()=>window.location.href,getAbsoluteHref:(t,e=document.baseURI)=>new URL(t,e).href,getOrigin:d,getPort:w,getPath:(t=window.location.href)=>p(t).path,getQuery:(t,e=!1)=>e?JSON.stringify(p(t).query):p(t).query,getHash:t=>p(t).hash,parse:p,parseQuery:v,clean:m};function b(e,i=2e3,s,r,n){return new Promise((h,o)=>{const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(a.readyState===XMLHttpRequest.DONE)if(200===a.status){const i=""!==a.responseURL&&a.responseURL!==e?a.responseURL:e;h({html:a.responseText,url:t({href:i},p(i))}),r.update(e,{status:"fulfilled",target:i})}else if(a.status){const t={status:a.status,statusText:a.statusText};s(e,t),o(t),r.update(e,{status:"rejected"})}},a.ontimeout=()=>{const t=new Error(`Timeout error [${i}]`);s(e,t),o(t),r.update(e,{status:"rejected"})},a.onerror=()=>{const t=new Error("Fetch error");s(e,t),o(t),r.update(e,{status:"rejected"})},a.open("GET",e),a.timeout=i,a.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml"),a.setRequestHeader("x-barba","yes"),n.all().forEach((t,e)=>{a.setRequestHeader(e,t)}),a.send()})}function y(t,e={}){return(...i)=>{let s=!1;return new Promise((r,n)=>{e.async=()=>(s=!0,(t,e)=>{t?n(t):r(e)});const h=t.apply(e,i);var o;s||(!(o=h)||"object"!=typeof o&&"function"!=typeof o||"function"!=typeof o.then?r(h):h.then(r,n))})}}const E=new class extends i{constructor(){super(),this.logger=new r("@barba/core"),this.all=["ready","page","reset","currentAdded","currentRemoved","nextAdded","nextRemoved","beforeOnce","once","afterOnce","before","beforeLeave","leave","afterLeave","beforeEnter","enter","afterEnter","after"],this.registered=new Map,this.init()}init(){this.registered.clear(),this.all.forEach(t=>{this[t]||(this[t]=(e,i)=>{this.registered.has(t)||this.registered.set(t,new Set),this.registered.get(t).add({ctx:i||{},fn:e})})})}do(t,...e){if(this.registered.has(t)){let i=Promise.resolve();return this.registered.get(t).forEach(t=>{i=i.then(()=>y(t.fn,t.ctx)(...e))}),i.catch(e=>{this.logger.debug(`Hook error [${t}]`),this.logger.error(e)})}return Promise.resolve()}clear(){this.all.forEach(t=>{delete this[t]}),this.init()}help(){this.logger.info(`Available hooks: ${this.all.join(",")}`);const t=[];this.registered.forEach((e,i)=>t.push(i)),this.logger.info(`Registered hooks: ${t.join(",")}`)}};class x{constructor(t){if(this.A=void 0,this._=[],"boolean"==typeof t)this.A=t;else{const e=Array.isArray(t)?t:[t];this._=e.map(t=>l(t))}}checkHref(t){if("boolean"==typeof this.A)return this.A;const{path:e}=p(t);return this._.some(t=>null!==t.exec(e))}}class P extends x{constructor(t){super(t),this.R=new Map}set(t,e,i,s,r){return this.R.set(t,{action:i,request:e,status:s,target:null!=r?r:t}),{action:i,request:e,status:s,target:r}}get(t){return this.R.get(t)}getRequest(t){return this.R.get(t).request}getAction(t){return this.R.get(t).action}getStatus(t){return this.R.get(t).status}getTarget(t){return this.R.get(t).target}has(t){return!this.checkHref(t)&&this.R.has(t)}delete(t){return this.R.delete(t)}update(e,i){const s=t({},this.R.get(e),i);return this.R.set(e,s),s}}class k{constructor(){this.$=new Map}set(t,e){return this.$.set(t,e),{name:e}}get(t){return this.$.get(t)}all(){return this.$}has(t){return this.$.has(t)}delete(t){return this.$.delete(t)}clear(){return this.$.clear()}}const A=()=>!window.history.pushState,_=({el:t,href:e})=>!t||!e,R=({event:t})=>t.which>1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey,$=({el:t})=>t.hasAttribute("target")&&"_blank"===t.target,T=({el:t})=>void 0!==t.protocol&&window.location.protocol!==t.protocol||void 0!==t.hostname&&window.location.hostname!==t.hostname,O=({el:t})=>void 0!==t.port&&w()!==w(t.href),L=({el:t})=>t.getAttribute&&"string"==typeof t.getAttribute("download"),M=({el:t})=>t.hasAttribute(`${o.prefix}-${o.prevent}`),C=({el:t})=>Boolean(t.closest(`[${o.prefix}-${o.prevent}="all"]`)),H=({href:t})=>m(t)===m()&&w(t)===w();class N extends x{constructor(t){super(t),this.suite=[],this.tests=new Map,this.init()}init(){this.add("pushState",A),this.add("exists",_),this.add("newTab",R),this.add("blank",$),this.add("corsDomain",T),this.add("corsPort",O),this.add("download",L),this.add("preventSelf",M),this.add("preventAll",C),this.add("sameUrl",H,!1)}add(t,e,i=!0){this.tests.set(t,e),i&&this.suite.push(t)}run(t,e,i,s){return this.tests.get(t)({el:e,event:i,href:s})}checkLink(t,e,i){return this.suite.some(s=>this.run(s,t,e,i))}}class S extends Error{constructor(t,e="Barba error",...i){super(...i),this.error=void 0,this.label=void 0,this.error=t,this.label=e,Error.captureStackTrace&&Error.captureStackTrace(this,S),this.name="BarbaError"}}class D{constructor(t=[]){this.logger=new r("@barba/core"),this.all=[],this.page=[],this.once=[],this.T=[{name:"namespace",type:"strings"},{name:"custom",type:"function"}],t&&(this.all=this.all.concat(t)),this.update()}add(t,e){"rule"===t?this.T.splice(e.position||0,0,e.value):this.all.push(e),this.update()}resolve(t,e={}){let i=e.once?this.once:this.page;i=i.filter(e.self?t=>t.name&&"self"===t.name:t=>!t.name||"self"!==t.name);const s=new Map,r=i.find(i=>{let r=!0;const n={};return e.self&&"self"===i.name?(s.set(i,n),!0):(this.T.reverse().forEach(e=>{r&&(r=this.O(i,e,t,n),i.from&&i.to&&(r=this.O(i,e,t,n,"from")&&this.O(i,e,t,n,"to")),i.from&&!i.to&&(r=this.O(i,e,t,n,"from")),!i.from&&i.to&&(r=this.O(i,e,t,n,"to")))}),s.set(i,n),r)}),n=s.get(r),h=[];if(h.push(e.once?"once":"page"),e.self&&h.push("self"),n){const t=[r];Object.keys(n).length>0&&t.push(n),this.logger.info(`Transition found [${h.join(",")}]`,...t)}else this.logger.info(`No transition found [${h.join(",")}]`);return r}update(){this.all=this.all.map(t=>this.L(t)).sort((t,e)=>t.priority-e.priority).reverse().map(t=>(delete t.priority,t)),this.page=this.all.filter(t=>void 0!==t.leave||void 0!==t.enter),this.once=this.all.filter(t=>void 0!==t.once)}O(t,e,i,s,r){let n=!0,h=!1;const o=t,{name:a,type:c}=e,u=a,l=a,f=a,d=r?o[r]:o,w="to"===r?i.next:i.current;if(r?d&&d[a]:d[a]){switch(c){case"strings":default:{const t=Array.isArray(d[u])?d[u]:[d[u]];w[u]&&-1!==t.indexOf(w[u])&&(h=!0),-1===t.indexOf(w[u])&&(n=!1);break}case"object":{const t=Array.isArray(d[l])?d[l]:[d[l]];w[l]?(w[l].name&&-1!==t.indexOf(w[l].name)&&(h=!0),-1===t.indexOf(w[l].name)&&(n=!1)):n=!1;break}case"function":d[f](i)?h=!0:n=!1}h&&(r?(s[r]=s[r]||{},s[r][a]=o[r][a]):s[a]=o[a])}return n}M(t,e,i){let s=0;return(t[e]||t.from&&t.from[e]||t.to&&t.to[e])&&(s+=Math.pow(10,i),t.from&&t.from[e]&&(s+=1),t.to&&t.to[e]&&(s+=2)),s}L(t){t.priority=0;let e=0;return this.T.forEach((i,s)=>{const{name:r}=i;e+=this.M(t,r,s+1)}),t.priority=e,t}}class j{constructor(t=[]){this.logger=new r("@barba/core"),this.store=void 0,this.C=!1,this.store=new D(t)}get(t,e){return this.store.resolve(t,e)}get isRunning(){return this.C}set isRunning(t){this.C=t}get hasOnce(){return this.store.once.length>0}get hasSelf(){return this.store.all.some(t=>"self"===t.name)}get shouldWait(){return this.store.all.some(t=>t.to&&!t.to.route||t.sync)}async doOnce({data:t,transition:e}){const i=e||{};this.C=!0;try{await this.H("beforeOnce",t,i),await this.once(t,i),await this.H("afterOnce",t,i)}catch(t){this.C=!1,this.logger.debug("Transition error [before/after/once]"),this.logger.error(t)}this.C=!1}async doPage({data:t,transition:e,page:i,wrapper:s}){const r=e||{},n=!0===r.sync||!1;this.C=!0;try{if(n&&await u(i,t),await this.H("before",t,r),n)try{await this.add(t,s),await this.H("beforeLeave",t,r),await this.H("beforeEnter",t,r),await Promise.all([this.leave(t,r),this.enter(t,r)]),await this.H("afterLeave",t,r),await this.H("afterEnter",t,r)}catch(t){if(this.N(t))throw new S(t,"Transition error [sync]")}else{let e=!1;try{await this.H("beforeLeave",t,r),e=await Promise.all([this.leave(t,r),u(i,t)]).then(t=>t[0]),await this.H("afterLeave",t,r)}catch(t){if(this.N(t))throw new S(t,"Transition error [before/after/leave]")}try{!1!==e&&(await this.add(t,s),await this.H("beforeEnter",t,r),await this.enter(t,r,e),await this.H("afterEnter",t,r))}catch(t){if(this.N(t))throw new S(t,"Transition error [before/after/enter]")}}await this.remove(t),await this.H("after",t,r)}catch(t){if(this.C=!1,t.name&&"BarbaError"===t.name)throw this.logger.debug(t.label),this.logger.error(t.error),t;throw this.logger.debug("Transition error [page]"),this.logger.error(t),t}this.C=!1}async once(t,e){return await E.do("once",t,e),e.once?y(e.once,e)(t):Promise.resolve()}async leave(t,e){return await E.do("leave",t,e),e.leave?y(e.leave,e)(t):Promise.resolve()}async enter(t,e,i){return await E.do("enter",t,e),e.enter?y(e.enter,e)(t,i):Promise.resolve()}async add(t,e){a.addContainer(t.next.container,e),E.do("nextAdded",t)}async remove(t){a.removeContainer(t.current.container),E.do("currentRemoved",t)}N(t){return t.message?!/Timeout error|Fetch error/.test(t.message):!t.status}async H(t,e,i){return await E.do(t,e,i),i[t]?y(i[t],i)(e):Promise.resolve()}}class q{constructor(t){this.names=["beforeLeave","afterLeave","beforeEnter","afterEnter"],this.byNamespace=new Map,0!==t.length&&(t.forEach(t=>{this.byNamespace.set(t.namespace,t)}),this.names.forEach(t=>{E[t](this.S(t))}))}S(t){return e=>{const{namespace:i}=t.match(/enter/i)?e.next:e.current,s=this.byNamespace.get(i);return s&&s[t]?y(s[t],s)(e):Promise.resolve()}}}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(t){let e=this;do{if(e.matches(t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null});const I={container:null,html:"",namespace:"",url:{hash:"",href:"",path:"",port:null,query:{}}},U=new class{constructor(){this.version="2.10.3",this.schemaPage=I,this.Logger=r,this.logger=new r("@barba/core"),this.plugins=[],this.timeout=void 0,this.cacheIgnore=void 0,this.cacheFirstPage=void 0,this.prefetchIgnore=void 0,this.preventRunning=void 0,this.hooks=E,this.cache=void 0,this.headers=void 0,this.prevent=void 0,this.transitions=void 0,this.views=void 0,this.dom=a,this.helpers=f,this.history=c,this.request=b,this.url=g,this.D=void 0,this.j=void 0,this.q=void 0,this.I=void 0}use(t,e){const i=this.plugins;i.indexOf(t)>-1?this.logger.warn(`Plugin [${t.name}] already installed.`):"function"==typeof t.install?(t.install(this,e),i.push(t)):this.logger.warn(`Plugin [${t.name}] has no "install" method.`)}init({transitions:e=[],views:i=[],schema:s=o,requestError:n,timeout:h=2e3,cacheIgnore:a=!1,cacheFirstPage:c=!1,prefetchIgnore:u=!1,preventRunning:l=!1,prevent:f=null,debug:d=!1,logLevel:w="off"}={}){if(r.setLevel(!0===d?"debug":w),this.logger.info(this.version),Object.keys(s).forEach(t=>{o[t]&&(o[t]=s[t])}),this.j=n,this.timeout=h,this.cacheIgnore=a,this.cacheFirstPage=c,this.prefetchIgnore=u,this.preventRunning=l,this.q=this.dom.getWrapper(),!this.q)throw new Error("[@barba/core] No Barba wrapper found");this.U();const{current:p}=this.data;if(!p.container)throw new Error("[@barba/core] No Barba container found");if(this.cache=new P(a),this.headers=new k,this.prevent=new N(u),this.transitions=new j(e),this.views=new q(i),null!==f){if("function"!=typeof f)throw new Error("[@barba/core] Prevent should be a function");this.prevent.add("preventCustom",f)}this.history.init(p.url.href,p.namespace),c&&this.cache.set(p.url.href,Promise.resolve({html:p.html,url:p.url}),"init","fulfilled"),this.B=this.B.bind(this),this.F=this.F.bind(this),this.W=this.W.bind(this),this.X(),this.plugins.forEach(t=>t.init());const v=this.data;v.trigger="barba",v.next=v.current,v.current=t({},this.schemaPage),this.hooks.do("ready",v),this.once(v),this.U()}destroy(){this.U(),this.G(),this.history.clear(),this.hooks.clear(),this.plugins=[]}get data(){return this.D}get wrapper(){return this.q}force(t){window.location.assign(t)}go(t,e="barba",i){if(this.I=null,this.transitions.isRunning)return void this.force(t);let s=!1;return s="popstate"===e?this.history.current&&this.url.getPath(this.history.current.url)===this.url.getPath(t)&&this.url.getQuery(this.history.current.url,!0)===this.url.getQuery(t,!0):this.prevent.run("sameUrl",null,null,t),!s||this.transitions.hasSelf?(e=this.history.change(this.cache.has(t)?this.cache.get(t).target:t,e,i),i&&(i.stopPropagation(),i.preventDefault()),this.page(t,e,null!=i?i:void 0,s)):void 0}async once(t){if(await this.hooks.do("beforeEnter",t),this.transitions.hasOnce){const e=this.transitions.get(t,{once:!0});await this.transitions.doOnce({transition:e,data:t})}await this.hooks.do("afterEnter",t)}async page(e,i,s,n){let h;if(this.data.next.url=t({href:e},this.url.parse(e)),this.data.trigger=i,this.data.event=s,this.cache.has(e))h=this.cache.update(e,{action:"click"}).request;else{const t=this.request(e,this.timeout,this.onRequestError.bind(this,i),this.cache,this.headers);t.then(t=>{t.url.href!==e&&this.history.add(t.url.href,i,"replace")}),h=this.cache.set(e,t,"click","pending").request}this.transitions.shouldWait&&await u(h,this.data);const o=this.data;await this.hooks.do("page",o);try{const t=this.transitions.get(o,{once:!1,self:n});await this.transitions.doPage({data:o,page:h,transition:t,wrapper:this.q}),this.U()}catch(t){0===r.getLevel()&&this.force(o.next.url.href)}}onRequestError(t,...e){this.transitions.isRunning=!1;const[i,s]=e,r=this.cache.getAction(i);return this.cache.delete(i),this.j&&!1===this.j(t,r,i,s)||"click"===r&&this.force(i),!1}prefetch(t){t=this.url.getAbsoluteHref(t),this.cache.has(t)||this.cache.set(t,this.request(t,this.timeout,this.onRequestError.bind(this,"barba"),this.cache,this.headers).catch(t=>{this.logger.error(t)}),"prefetch","pending")}X(){!0!==this.prefetchIgnore&&(document.addEventListener("mouseover",this.B),document.addEventListener("touchstart",this.B)),document.addEventListener("click",this.F),window.addEventListener("popstate",this.W)}G(){!0!==this.prefetchIgnore&&(document.removeEventListener("mouseover",this.B),document.removeEventListener("touchstart",this.B)),document.removeEventListener("click",this.F),window.removeEventListener("popstate",this.W)}B(t){const e=this.J(t);if(!e)return;const i=this.url.getAbsoluteHref(this.dom.getHref(e));this.prevent.checkHref(i)||this.cache.has(i)||this.cache.set(i,this.request(i,this.timeout,this.onRequestError.bind(this,e),this.cache,this.headers).catch(t=>{this.logger.error(t)}),"enter","pending")}F(t){const e=this.J(t);if(e){if(this.transitions.isRunning&&this.preventRunning)return t.preventDefault(),void t.stopPropagation();this.I=t,this.go(this.dom.getHref(e),e,t)}}W(t){this.go(this.url.getHref(),"popstate",t)}J(t){let e=t.target;for(;e&&!this.dom.getHref(e);)e=e.parentNode;if(e&&!this.prevent.checkLink(e,t,this.dom.getHref(e)))return e}U(){const e=this.url.getHref(),i={container:this.dom.getContainer(),html:this.dom.getHtml(),namespace:this.dom.getNamespace(),url:t({href:e},this.url.parse(e))};this.D={current:i,event:void 0,next:t({},this.schemaPage),trigger:void 0},this.hooks.do("reset",this.data)}};export{U as default};
//# sourceMappingURL=barba.modern.mjs.map
